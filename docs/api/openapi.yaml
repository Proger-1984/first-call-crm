openapi: 3.0.0
info:
  title: First Call API
  version: 1.0.0
  description: |
    REST API для crm и мобильного приложения.
    
    ## Аутентификация
    API использует JWT токены для аутентификации. Получить токен можно через:
    - Авторизацию через Telegram (для crm)
    - Авторизацию через логин и пароль (для приложения)
    
    ## Общие принципы
    - Все запросы где требуется аунтификация должны содержать `Authorization: BearerAuth`
    - Все запросы должны содержать заголовок `Content-Type: application/json`
    - Все ответы возвращаются в формате JSON
    - В случае ошибки возвращается объект с полями `code`, `status`, `message` и `error`
    
    ## Коды ответов
    - 200: Успешный запрос
    - 400: Неверный формат запроса (неправильный формат JSON, отсутствие|пустые обязательные поля, неверный тип данных)
    - 401: Не авторизован
    - 403: Доступ запрещен
    - 404: Ресурс не найден
    - 422: Ошибка валидации (нарушение бизнес-правил, неверный формат данных, конфликт значений)
    - 500: Внутренняя ошибка сервера

tags:
  - name: Аутентификация
    description: Методы для авторизации и управления токенами
  - name: Пользователь
    description: Методы для работы с данными пользователя
  - name: Подписки
    description: Методы для управления подписками
  - name: Локации
    description: Методы для управления локациями и полигонами
  - name: Конфигурация
    description: Методы для получения конфигурационных данных
  - name: Администрирование
    description: Методы для администраторов системы
  - name: Billing
    description: Методы для управления биллингом подписок

servers:
  - url: http://localhost:8080
    description: Локальный сервер разработки
  - url: https://rest-api.firstcall.com
    description: Продакшн сервер

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT токен доступа

  schemas:
    Error:
      type: object
      properties:
        code:
          type: integer
          description: HTTP код ошибки
          example: 400
        status:
          type: string
          description: Статус ответа
          example: error
        message:
          type: string
          description: Сообщение об ошибке
          example: Неверный формат данных
        error:
          type: string
          description: Код ошибки для программной обработки
          enum:
            - token_not_found
            - token_expired
            - invalid_token
            - invalid_token_type
            - invalid_credentials
            - subscription_expired
            - validation_error
          example: validation_error

    Source:
      type: object
      properties:
        id:
          type: integer
          description: ID источника
          example: 1
        name:
          type: string
          description: Название источника
          example: "Телефонный звонок"
        enabled:
          type: boolean
          description: Включен ли источник
          example: true

    Category:
      type: object
      properties:
        id:
          type: integer
          description: ID категории
          example: 1
        name:
          type: string
          description: Название категории
          example: "Важные звонки"
        enabled:
          type: boolean
          description: Включена ли категория
          example: true

    PhoneStatus:
      type: object
      required:
        - status
      properties:
        status:
          type: boolean
          description: Статус телефона (true - занят, false - свободен)
          example: true

    TelegramAuth:
      type: object
      required:
        - id
        - first_name
        - auth_date
        - hash
      properties:
        id:
          type: integer
          description: Telegram ID пользователя
          example: 123456789
        first_name:
          type: string
          description: Имя пользователя
          example: John
        last_name:
          type: string
          description: Фамилия пользователя
          example: Doe
        username:
          type: string
          description: Имя пользователя в Telegram
          example: johndoe
        photo_url:
          type: string
          description: URL фотографии пользователя
          example: https://t.me/i/userpic/320/123456789.jpg
        auth_date:
          type: integer
          description: Дата авторизации (Unix timestamp)
          example: 1616432400
        hash:
          type: string
          description: Хеш для проверки данных
          example: 1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef

    LoginCredentials:
      type: object
      required:
        - login
        - password
      properties:
        login:
          type: string
          description: Логин
          example: "111"
        password:
          type: string
          description: Пароль
          example: "password123"

    UserSettings:
      type: object
      properties:
        settings:
          type: object
          properties:
            log_events:
              type: boolean
              description: Включено ли логирование событий
              example: false
            auto_call:
              type: boolean
              description: Включен ли автоматический звонок
              example: false
            auto_call_raised:
              type: boolean
              description: Включен ли автоматический звонок на поднятые объявления
              example: false
            telegram_notifications:
              type: boolean
              description: Включены ли уведомления в Telegram
              example: false
        sources:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
                description: ID источника
                example: 1
              name:
                type: string
                description: Название источника
                example: "Авито"
              enabled:
                type: boolean
                description: Включен ли источник
                example: true
        active_subscriptions:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
                description: ID подписки
                example: 3
              name:
                type: string
                description: Название подписки
                example: "Аренда. Жилая|Москва, Московская область"
              enabled:
                type: boolean
                description: Включена ли подписка
                example: true

    UserInfo:
      type: object
      properties:
        user:
          type: object
          properties:
            id:
              type: integer
              description: ID пользователя
              example: 1
            name:
              type: string
              description: Имя пользователя
              example: "John Doe"
            telegram_photo_url:
              type: string
              description: URL фотографии пользователя в Telegram
              example: "https://t.me/i/userpic/320/123456789.jpg"
            role:
              type: string
              description: Роль пользователя
              example: "user"
            is_trial_used:
              type: boolean
              description: Использовал ли пользователь демо-версию
              example: false
            phone_status:
              type: boolean
              description: Статус телефона (true - занят, false - свободен)
              example: true
            auto_call:
              type: boolean
              description: Включен ли автоматический звонок
              example: true
            auto_call_raised:
              type: boolean
              description: Включен ли автоматический звонок на поднятые объявления
              example: false
            has_active_subscription:
              type: boolean
              description: Есть ли у пользователя активная подписка (демо или премиум)
              example: true
            subscription_status_text:
              type: string
              description: Текст с информацией о статусе подписки
              example: "Доступ до 31.12.2024 23:59\nОсталось 30 дней"

    Tokens:
      type: object
      properties:
        code:
          type: integer
          description: HTTP код ответа
          example: 200
        status:
          type: string
          description: Статус ответа
          example: success
        access_token:
          type: string
          description: JWT токен доступа
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        refresh_token:
          type: string
          description: JWT токен обновления (только для мобильного приложения)
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        expires_in:
          type: integer
          description: Время жизни токена в секундах
          example: 3600

    SubscriptionRequest:
      type: object
      required:
        - tariff_id
        - category_id
        - location_id
      properties:
        tariff_id:
          type: integer
          description: ID тарифа
          example: 1
        category_id:
          type: integer
          description: ID категории (можно выбрать только одну категорию)
          example: 1
        location_id:
          type: integer
          description: ID локации
          example: 1

    UserStatus:
      type: object
      properties:
        phone_status:
          type: boolean
          description: Статус телефона (true - занят, false - свободен)
          example: true
        auto_call:
          type: boolean
          description: Включен ли автоматический звонок
          example: false
        auto_call_raised:
          type: boolean
          description: Включен ли автоматический звонок на поднятые объявления
          example: false

    AutoCallStatus:
      type: object
      required:
        - auto_call
      properties:
        auto_call:
          type: boolean
          description: Включен ли автоматический звонок
          example: true
        auto_call_raised:
          type: boolean
          description: Включен ли автоматический звонок на поднятые объявления
          example: false

    LocationPolygon:
      type: object
      properties:
        id:
          type: integer
          description: ID локации
          example: 1
        name:
          type: string
          description: Название локации
          example: "Центр города"
        subscription_id:
          type: integer
          description: ID подписки, к которой относится локация
          example: 2
        polygon_coordinates:
          type: array
          description: Массив координат точек полигона
          items:
            type: array
            items:
              type: number
          example: [[55.7522, 37.6156], [55.7512, 37.6176], [55.7532, 37.6196], [55.7522, 37.6156]]
        center_lat:
          type: number
          description: Широта центра локации
          example: 55.7522
        center_lng:
          type: number
          description: Долгота центра локации
          example: 37.6156
        created_at:
          type: string
          format: date-time
          description: Дата и время создания локации
          example: "2023-08-15T13:45:30Z"
        updated_at:
          type: string
          format: date-time
          description: Дата и время последнего обновления локации
          example: "2023-08-16T10:22:15Z"

    Subscription:
      type: object
      properties:
        id:
          type: integer
          description: ID подписки
          example: 2
        user_id:
          type: integer
          description: ID пользователя
          example: 123
        is_active:
          type: boolean
          description: Активна ли подписка в данный момент
          example: true
        start_date:
          type: string
          format: date-time
          description: Дата и время начала подписки
          example: "2023-08-10T00:00:00Z"
        end_date:
          type: string
          format: date-time
          description: Дата и время окончания подписки
          example: "2023-09-10T00:00:00Z"
        location:
          type: object
          properties:
            id:
              type: integer
              description: ID локации
              example: 1
            name:
              type: string
              description: Название локации
              example: "Москва, Московская область"
            center_lat:
              type: number
              description: Широта центра локации
              example: 55.7522
            center_lng:
              type: number
              description: Долгота центра локации
              example: 37.6156
            bounds:
              type: object
              properties:
                north:
                  type: number
                  description: Северная географическая граница (широта)
                  example: 56.0221
                south:
                  type: number
                  description: Южная географическая граница (широта)
                  example: 55.4915
                east:
                  type: number
                  description: Восточная географическая граница (долгота)
                  example: 38.1774
                west:
                  type: number
                  description: Западная географическая граница (долгота)
                  example: 36.8034
        category:
          type: object
          properties:
            id:
              type: integer
              description: ID категории
              example: 1
            name:
              type: string
              description: Название категории
              example: "Аренда. Жилая"

paths:
  /api/v1/auth/telegram:
    post:
      summary: Авторизация через Telegram
      description: |
        Авторизация пользователя через Telegram.
        
        Для авторизации необходимо передать данные, полученные от Telegram Login Widget.
        Все данные должны быть подписаны с помощью секретного ключа бота.
        
        При успешной авторизации:
        - В теле ответа возвращается access_token
        - В куках устанавливается refresh_token
      tags:
        - Аутентификация
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TelegramAuth'
      responses:
        '200':
          description: Успешная авторизация
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    description: HTTP код ответа
                    example: 200
                  status:
                    type: string
                    description: Статус ответа
                    example: success
                  message:
                    type: string
                    description: Сообщение об успешной авторизации
                    example: "Успешная авторизация через Telegram"
                  access_token:
                    type: string
                    description: JWT токен доступа
                    example: "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
          headers:
            Set-Cookie:
              schema:
                type: string
                example: "refreshToken=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...; path=/api/v1/auth; domain=.example.com; max-age=2592000; expires=Wed, 06 May 2024 12:00:00 GMT; HttpOnly; Secure; SameSite=None"
        '400':
          description: |
            Неверный формат запроса
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 400
                status: error
                message: Неверный формат запроса
                error: validation_error
        '422':
          description: Ошибка валидации данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 422
                status: error
                message: Ошибка авторизации через Telegram
                error: validation_error
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: Внутренняя ошибка сервера
                error: internal_error

  /api/v1/auth/telegram/rebind:
    post:
      tags:
        - Аутентификация
      summary: Перепривязка Telegram аккаунта
      description: |
        Перепривязывает Telegram аккаунт к существующему пользователю.
        Требуется аутентификация через JWT токен.
        
        ## Возможные ошибки
        
        - 400: Неверный формат запроса (отсутствуют обязательные поля)
        - 401: Не авторизован (отсутствует или недействителен JWT токен)
        - 404: Пользователь не найден
        - 409: Telegram аккаунт уже привязан к другому пользователю
        - 422: Ошибка валидации данных Telegram или сохранения
        - 500: Внутренняя ошибка сервера
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TelegramAuth'
      responses:
        '200':
          description: Telegram аккаунт успешно перепривязан
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    description: HTTP код ответа
                    example: 200
                  status:
                    type: string
                    description: Статус ответа (всегда "success" при успешном выполнении)
                    example: success
                  message:
                    type: string
                    description: Сообщение об успешной перепривязке
                    example: Telegram аккаунт успешно перепривязан
                  data:
                    type: object
                    description: Данные о результатах перепривязки
                    properties:
                      user_id:
                        type: integer
                        description: ID пользователя в системе, к которому привязан Telegram аккаунт
                        example: 123
                      telegram_id:
                        type: integer
                        description: ID пользователя в Telegram
                        example: 456789
                      old_telegram_id:
                        type: integer
                        nullable: true
                        description: ID предыдущего Telegram аккаунта, если он был привязан
                        example: 123456
        '400':
          description: Неверный формат запроса
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 400
                status: error
                message: "Неверный формат запроса. Отсутствуют обязательные поля"
                error: "validation_error"
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
        '404':
          description: Пользователь не найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 404
                status: error
                message: "Пользователь не найден"
                error: "user_not_found"
        '409':
          description: Конфликт - Telegram аккаунт уже привязан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 409
                status: error
                message: "Этот Telegram аккаунт уже привязан к другому пользователю"
                error: "telegram_already_bound"
        '422':
          description: Ошибка валидации или сохранения
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_telegram_data:
                  value:
                    code: 422
                    status: error
                    message: "Невалидные данные авторизации Telegram при перепривязке"
                    error: "invalid_telegram_data"
                save_failed:
                  value:
                    code: 422
                    status: error
                    message: "Не удалось сохранить данные пользователя"
                    error: "save_failed"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/auth/login:
    post:
      summary: Авторизация через приложение
      description: |
        Авторизация пользователя через логин и пароль.
        
        После успешной авторизации возвращается:
        - access_token - JWT токен для доступа к API
        - refresh_token - токен для обновления access_token
        - expires_in - время жизни токена в секундах
      tags:
        - Аутентификация
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginCredentials'
      responses:
        '200':
          description: Успешная авторизация
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tokens'
        '400':
          description: |
            Неверный формат запроса
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 400
                status: error
                message: Неверный формат запроса
                error: validation_error
        '401':
          description: |
            Ошибка авторизации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 401
                status: error
                message: Неверный логин или пароль
                error: invalid_credentials
        '403':
          description: |
            Доступ запрещен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 403
                status: error
                message: "Доступ запрещен: подписка истекла"
                error: subscription_expired
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: Внутренняя ошибка сервера
                error: internal_error

  /api/v1/auth/refresh:
    get:
      tags:
        - Аутентификация
      summary: Обновление токена доступа
      description: |
        Обновляет пару токенов (access и refresh) с помощью refresh токена.
        Для веб-клиента refresh токен берется из куки, для мобильного приложения - из заголовка Authorization.
        Тип клиента определяется автоматически из токена.
      security: []
      responses:
        '200':
          description: Токены успешно обновлены
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tokens'
          headers:
            Set-Cookie:
              schema:
                type: string
                description: Куки с refresh токеном (только для веб-клиента)
                example: refreshToken=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...; path=/api/v1/auth; domain=.firstcall.com; max-age=2592000; expires=Wed, 21 Oct 2023 07:28:00 GMT; HttpOnly; Secure; SameSite=None
        '401':
          description: Ошибка аутентификации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: Refresh token not found
                    error: token_not_found
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: Refresh token expired
                    error: token_expired
                invalid_token:
                  value:
                    code: 401
                    status: error
                    message: Invalid refresh token
                    error: invalid_token
                invalid_token_type:
                  value:
                    code: 401
                    status: error
                    message: Invalid token type
                    error: invalid_token_type
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/auth/logout:
    get:
      summary: Выход из системы
      description: |
        Выход пользователя из системы.

        Access токен должен быть передан в заголовке Authorization.
        Токен должен быть валидным и не истекшим.

        Текущий токен будет признан недействительным.
        Выход выполняется только для текущего типа устройства.
      tags:
        - Аутентификация
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Успешный выход из системы
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: "Успешный выход из системы."
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
                invalid_token:
                  value:
                    code: 401
                    status: error
                    message: "Invalid access token"
                    error: "invalid_token"
        '404':
          description: Пользователь не найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 404
                status: error
                message: "User not found"
                error: "user_not_found"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/auth/logout-all:
    get:
      summary: Выход из всех устройств
      description: |
        Выход пользователя из всех устройств.

        Access токен должен быть передан в заголовке Authorization.
        Токен должен быть валидным и не истекшим.

        Все токены пользователя будут признаны недействительными.
        Пользователю потребуется повторная авторизация для входа в систему.
      tags:
        - Аутентификация
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Успешный выход из всех устройств
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: "Успешный выход из всех устройств."
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
                invalid_token:
                  value:
                    code: 401
                    status: error
                    message: "Invalid access token"
                    error: "invalid_token"
        '404':
          description: Пользователь не найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 404
                status: error
                message: "User not found"
                error: "user_not_found"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/config/telegram-bot-username:
    get:
      summary: Получение имени бота
      description: Получение имени бота Telegram для авторизации
      tags:
        - Конфигурация
      responses:
        '200':
          description: Имя бота получено
          content:
            application/json:
              schema:
                type: object
                properties:
                  username:
                    type: string
                    description: Имя бота в Telegram
                    example: "firstcall_bot"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: Внутренняя ошибка сервера
                error: internal_error

  /api/v1/me/settings:
    get:
      tags:
        - Пользователь
      summary: Получение настроек пользователя
      description: Возвращает настройки пользователя, включая источники и активные подписки
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Успешное получение настроек
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/UserSettings'
              example:
                code: 200
                status: success
                data:
                  settings:
                    log_events: false
                    auto_call: true
                    auto_call_raised: false
                    telegram_notifications: true
                  sources:
                    - id: 1
                      name: "Авито"
                      enabled: true
                    - id: 2
                      name: "Яндекс.Н"
                      enabled: true
                    - id: 3
                      name: "Циан"
                      enabled: false
                    - id: 4
                      name: "ЮЛА"
                      enabled: true
                  active_subscriptions:
                    - id: 3
                      name: "Аренда. Жилая|Москва, Московская область"
                      enabled: true
                    - id: 2
                      name: "Продажа. Жилая|Москва, Московская область"
                      enabled: true
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

    put:
      summary: Обновление настроек пользователя
      description: |
        Обновление настроек пользователя.

        Access токен должен быть передан в заголовке Authorization.
        
        Можно обновить как отдельные настройки, так и все сразу.
        
        При обновлении источников необходимо передать все источники, даже если их статус не меняется.
      tags:
        - Пользователь
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserSettings'
            example:
              settings:
                log_events: false
                auto_call: false
                auto_call_raised: false
                telegram_notifications: false
              sources:
                - id: 1
                  name: "Авито"
                  enabled: true
                - id: 2
                  name: "Яндекс.Н"
                  enabled: true
                - id: 3
                  name: "Циан"
                  enabled: true
                - id: 4
                  name: "ЮЛА"
                  enabled: true
              active_subscriptions:
                - id: 3
                  name: "Аренда. Жилая|Москва, Московская область"
                  enabled: true
                - id: 2
                  name: "Продажа. Жилая|Москва, Московская область"
                  enabled: true
      responses:
        '200':
          description: Настройки обновлены
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: "Настройки успешно обновлены"
                  data:
                    $ref: '#/components/schemas/UserSettings'
        '400':
          description: "Неверный формат запроса"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_json:
                  value:
                    code: 400
                    status: error
                    message: "Неверный формат запроса"
                    error: "validation_error"
        '401':
          description: "Токен отсутствует или недействителен"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
        '500':
          description: "Внутренняя ошибка сервера"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/me/phone-status:
    put:
      summary: Обновить статус телефона
      description: |
        Обновляет статус телефона пользователя (занят/свободен).
        
        Этот статус может использоваться для маршрутизации звонков и отображения
        текущего состояния пользователя в интерфейсе.
      tags:
        - Пользователь
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PhoneStatus'
      responses:
        '200':
          description: Статус телефона успешно обновлен
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Статус телефона успешно обновлен
        '400':
          description: "Неверный формат запроса"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_json:
                  value:
                    code: 400
                    status: error
                    message: "Неверный формат запроса. Данные должны быть переданы в формате JSON"
                    error: "validation_error"
                missing_status:
                  value:
                    code: 400
                    status: error
                    message: "Неверный формат запроса. Отсутствует обязательное поле status"
                    error: "validation_error"
                invalid_status_type:
                  value:
                    code: 400
                    status: error
                    message: "Неверный формат запроса. Поле status должно быть boolean"
                    error: "validation_error"
        '401':
          description: "Ошибка аутентификации"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Token not found"
                    error: "token_not_found"
                invalid_token:
                  value:
                    code: 401
                    status: error
                    message: "Invalid token"
                    error: "invalid_token"
                invalid_token_type:
                  value:
                    code: 401
                    status: error
                    message: "Invalid token type"
                    error: "invalid_token_type"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Token expired"
                    error: "token_expired"
        '500':
          description: "Внутренняя ошибка сервера"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/subscriptions:
    get:
      tags:
        - Подписки
      summary: Получение списка активных подписок пользователя
      description: |
        Возвращает список активных подписок авторизованного пользователя.
        
        Для каждой подписки возвращается информация:
        - ID подписки
        - Информация о локации (ID, полное название с категорией, координаты центра, географические границы)
        
        Требуется аутентификация с помощью JWT токена.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Успешное получение списка подписок
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    description: HTTP код ответа
                    example: 200
                  status:
                    type: string
                    description: Статус ответа
                    example: success
                  data:
                    type: object
                    properties:
                      subscriptions:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                              description: ID подписки
                              example: 2
                            location:
                              type: object
                              properties:
                                id:
                                  type: integer
                                  description: ID локации
                                  example: 1
                                name:
                                  type: string
                                  description: Название локации с категорией
                                  example: "Москва, Московская область | Аренда. Жилая"
                                center_lat:
                                  type: number
                                  description: Широта центра локации
                                  example: 55.7522
                                center_lng:
                                  type: number
                                  description: Долгота центра локации
                                  example: 37.6156
                                bounds:
                                  type: object
                                  properties:
                                    north:
                                      type: number
                                      description: Северная географическая граница (широта)
                                      example: 56.0221
                                    south:
                                      type: number
                                      description: Южная географическая граница (широта)
                                      example: 55.4915
                                    east:
                                      type: number
                                      description: Восточная географическая граница (долгота)
                                      example: 38.1774
                                    west:
                                      type: number
                                      description: Западная географическая граница (долгота)
                                      example: 36.8034
              example:
                code: 200
                status: success
                data:
                  subscriptions:
                    - id: 2
                      location:
                        id: 1
                        name: "Москва, Московская область | Аренда. Жилая"
                        center_lat: 55.7522
                        center_lng: 37.6156
                        bounds:
                          north: 56.0221
                          south: 55.4915
                          east: 38.1774
                          west: 36.8034
                    - id: 3
                      location:
                        id: 1
                        name: "Москва, Московская область | Продажа. Жилая"
                        center_lat: 55.7522
                        center_lng: 37.6156
                        bounds:
                          north: 56.0221
                          south: 55.4915
                          east: 38.1774
                          west: 36.8034
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

    post:
      summary: Создание заявки на подписку
      description: |
        Создает заявку на подписку для пользователя.
        
        Для каждой подписки пользователь может выбрать только одну категорию.
        При выборе платного тарифа и наличии активной демо-подписки,
        демо-подписка автоматически отменяется.
        
        Требуется аутентификация с помощью JWT токена.
      tags:
        - Подписки
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubscriptionRequest'
            examples:
              subscriptionRequest:
                summary: Запрос на подписку
                value:
                  tariff_id: 1
                  category_id: 1
                  location_id: 1
      responses:
        '200':
          description: Заявка на подписку успешно создана
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    description: HTTP код ответа
                    example: 200
                  status:
                    type: string
                    description: Статус ответа
                    example: success
                  message:
                    type: string
                    description: Сообщение о результате операции
                    example: "Заявки на подписку успешно созданы"
        '400':
          description: Неверный формат запроса или бизнес-ограничения
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                validation_error:
                  value:
                    code: 400
                    status: error
                    message: "Неверный формат запроса. Отсутствует или неверный формат tariff_id"
                    error: "validation_error"
                invalid_category:
                  value:
                    code: 400
                    status: error
                    message: "Неверный формат запроса. Отсутствует или неверный формат category_id"
                    error: "validation_error"
                already_used_trial:
                  value:
                    code: 400
                    status: error
                    message: "Вы уже использовали демо-тариф ранее"
                    error: "validation_error"
                subscription_exists:
                  value:
                    code: 400
                    status: error
                    message: "Не удалось создать подписки. Возможно, они уже существуют"
                    error: "operation_failed"
        '401':
          description: Токен отсутствует или недействителен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
        '404':
          description: Запрашиваемый ресурс не найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                tariff_not_found:
                  value:
                    code: 404
                    status: error
                    message: "Указанный тариф не найден"
                    error: "not_found"
                location_not_found:
                  value:
                    code: 404
                    status: error
                    message: "Указанная локация не найдена"
                    error: "not_found"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/subscriptions/all:
    get:
      tags:
        - Подписки
      summary: Получение всех подписок пользователя (для профиля)
      description: |
        Возвращает все подписки пользователя, включая активные, истёкшие и отменённые.
        
        Используется на странице профиля для отображения истории подписок.
        
        Подписки отсортированы: сначала активные, затем ожидающие, затем истёкшие.
        
        Требуется аутентификация с помощью JWT токена.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Успешное получение списка всех подписок
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      subscriptions:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                              description: ID подписки
                              example: 2
                            category_id:
                              type: integer
                              description: ID категории
                              example: 1
                            category_name:
                              type: string
                              description: Название категории
                              example: "Аренда. Жилая"
                            location_id:
                              type: integer
                              description: ID локации
                              example: 1
                            location_name:
                              type: string
                              description: Полное название локации
                              example: "Москва, Московская область"
                            tariff_id:
                              type: integer
                              description: ID тарифа
                              example: 2
                            tariff_name:
                              type: string
                              description: Название тарифа
                              example: "Премиум 1 месяц"
                            status:
                              type: string
                              description: Статус подписки
                              enum: [active, pending, expired, cancelled]
                              example: "active"
                            start_date:
                              type: string
                              format: date-time
                              nullable: true
                              description: Дата начала подписки
                              example: "2024-01-15T10:00:00+03:00"
                            end_date:
                              type: string
                              format: date-time
                              nullable: true
                              description: Дата окончания подписки
                              example: "2024-02-15T10:00:00+03:00"
                            price_paid:
                              type: number
                              description: Оплаченная сумма
                              example: 5000
                            is_enabled:
                              type: boolean
                              description: Включена ли подписка
                              example: true
              example:
                code: 200
                status: success
                data:
                  subscriptions:
                    - id: 2
                      category_id: 1
                      category_name: "Аренда. Жилая"
                      location_id: 1
                      location_name: "Москва, Московская область"
                      tariff_id: 2
                      tariff_name: "Премиум 1 месяц"
                      status: "active"
                      start_date: "2024-01-15T10:00:00+03:00"
                      end_date: "2024-02-15T10:00:00+03:00"
                      price_paid: 5000
                      is_enabled: true
                    - id: 1
                      category_id: 1
                      category_name: "Аренда. Жилая"
                      location_id: 1
                      location_name: "Москва, Московская область"
                      tariff_id: 1
                      tariff_name: "Демо"
                      status: "expired"
                      start_date: "2024-01-01T10:00:00+03:00"
                      end_date: "2024-01-01T13:00:00+03:00"
                      price_paid: 0
                      is_enabled: false
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/location-polygons/subscription/{subscription_id}:
    get:
      tags:
        - Локации
      summary: Получение локаций пользователя по ID подписки
      description: |
        Возвращает список локаций пользователя для указанной подписки.
        
        Для каждой локации возвращается информация:
        - ID и название локации
        - Координаты полигона локации (polygon_coordinates)
        - Координаты центра локации (center_lat, center_lng)
        - Географические границы локации (bounds)
        - Дата создания
        
        Требуется аутентификация с помощью JWT токена.
      security:
        - BearerAuth: []
      parameters:
        - name: subscription_id
          in: path
          required: true
          description: ID подписки
          schema:
            type: integer
          example: 2
        - name: subscription_id
          in: query
          required: false
          description: ID подписки (дублирующий параметр для совместимости)
          schema:
            type: integer
          example: 2
      responses:
        '200':
          description: Успешное получение списка локаций
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    description: HTTP код ответа
                    example: 200
                  status:
                    type: string
                    description: Статус ответа
                    example: success
                  data:
                    type: object
                    properties:
                      location_polygons:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                              description: ID локации
                              example: 1
                            name:
                              type: string
                              description: Название локации
                              example: "Центр города"
                            polygon_coordinates:
                              type: array
                              description: Массив координат точек полигона
                              items:
                                type: array
                                items:
                                  type: number
                              example: [[55.7522, 37.6156], [55.7512, 37.6176], [55.7532, 37.6196], [55.7522, 37.6156]]
                            center_lat:
                              type: number
                              description: Широта центра локации
                              example: 55.7522
                            center_lng:
                              type: number
                              description: Долгота центра локации
                              example: 37.6156
                            bounds:
                              type: object
                              properties:
                                north:
                                  type: number
                                  description: Северная географическая граница (широта)
                                  example: 56.0221
                                south:
                                  type: number
                                  description: Южная географическая граница (широта)
                                  example: 55.4915
                                east:
                                  type: number
                                  description: Восточная географическая граница (долгота)
                                  example: 38.1774
                                west:
                                  type: number
                                  description: Западная географическая граница (долгота)
                                  example: 36.8034
                            created_at:
                              type: string
                              format: date-time
                              description: Дата и время создания локации
                              example: "2023-08-15T13:45:30Z"
              example:
                code: 200
                status: success
                data:
                  location_polygons:
                    - id: 1
                      name: "Центр города"
                      polygon_coordinates: [[55.7522, 37.6156], [55.7512, 37.6176], [55.7532, 37.6196], [55.7522, 37.6156]]
                      center_lat: 55.7522
                      center_lng: 37.6156
                      bounds:
                        north: 56.0221
                        south: 55.4915
                        east: 38.1774
                        west: 36.8034
                      created_at: "2023-08-15T13:45:30Z"
                    - id: 2
                      name: "Бизнес-район"
                      polygon_coordinates: [[55.7682, 37.5489], [55.7672, 37.5509], [55.7692, 37.5529], [55.7682, 37.5489]]
                      center_lat: 55.7682
                      center_lng: 37.5489
                      bounds:
                        north: 56.0321
                        south: 55.5015
                        east: 38.2774
                        west: 36.9034
                      created_at: "2023-08-17T09:30:45Z"
        '400':
          description: Неверный формат запроса
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 400
                status: error
                message: "Некорректный ID подписки"
                error: "validation_error"
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
        '404':
          description: Подписка не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 404
                status: error
                message: "Подписка не найдена"
                error: "not_found"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/location-polygons:
    post:
      tags:
        - Локации
      summary: Создание новой локации
      description: |
        Создает новую локацию (полигон) для указанной подписки пользователя.
        
        После создания локации автоматически вычисляются и заполняются поля:
        - center_lat и center_lng (координаты центра)
        - bounds (географические границы)
        - PostGIS поля center_point и polygon
        
        Требуется аутентификация с помощью JWT токена.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - subscription_id
                - name
                - polygon_coordinates
              properties:
                subscription_id:
                  type: integer
                  description: ID подписки, к которой относится локация
                  example: 2
                name:
                  type: string
                  description: Название локации
                  example: "Центр города"
                polygon_coordinates:
                  type: array
                  description: Массив координат точек полигона [[lat, lng], ...]
                  items:
                    type: array
                    items:
                      type: number
                  example: [[55.7522, 37.6156], [55.7512, 37.6176], [55.7532, 37.6196], [55.7522, 37.6156]]
            example:
              subscription_id: 2
              name: "Центр города"
              polygon_coordinates: [[55.7522, 37.6156], [55.7512, 37.6176], [55.7532, 37.6196], [55.7522, 37.6156]]
      responses:
        '201':
          description: Локация успешно создана
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    description: HTTP код ответа
                    example: 201
                  status:
                    type: string
                    description: Статус ответа
                    example: success
                  message:
                    type: string
                    description: Сообщение о результате операции
                    example: "Локация успешно создана"
              example:
                code: 201
                status: success
                message: "Локация успешно создана"
        '400':
          description: Неверный формат запроса
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalid_json:
                  value:
                    code: 400
                    status: error
                    message: "Данные должны быть переданы в формате JSON"
                    error: "validation_error"
                missing_subscription_id:
                  value:
                    code: 400
                    status: error
                    message: "Отсутствует или неверный формат subscription_id"
                    error: "validation_error"
                missing_name:
                  value:
                    code: 400
                    status: error
                    message: "Отсутствует название локации"
                    error: "validation_error"
                missing_polygon:
                  value:
                    code: 400
                    status: error
                    message: "Отсутствуют или неверный формат координат полигона"
                    error: "validation_error"
                invalid_polygon:
                  value:
                    code: 400
                    status: error
                    message: "Полигон должен содержать минимум 3 точки"
                    error: "validation_error"
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
        '404':
          description: Подписка не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 404
                status: error
                message: "Указанная подписка не найдена"
                error: "not_found"
        '422':
          description: Ошибка валидации или сохранения данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 422
                status: error
                message: "Не удалось обновить геометрические поля"
                error: "save_failed"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/location-polygons/{id}:
    put:
      tags:
        - Локации
      summary: Обновление существующей локации
      description: |
        Обновляет существующую локацию пользователя.
        
        Если изменились координаты полигона, автоматически пересчитываются и обновляются:
        - center_lat и center_lng (координаты центра)
        - bounds (географические границы)
        - PostGIS поля center_point и polygon
        
        Требуется аутентификация с помощью JWT токена.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID локации для обновления
          schema:
            type: integer
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - subscription_id
                - polygon_coordinates
              properties:
                name:
                  type: string
                  description: Название локации
                  example: "Новое название"
                subscription_id:
                  type: integer
                  description: ID подписки
                  example: 3
                polygon_coordinates:
                  type: array
                  description: Массив координат точек полигона
                  items:
                    type: array
                    items:
                      type: number
                  example: [[55.7522, 37.6156], [55.7512, 37.6176], [55.7532, 37.6196], [55.7522, 37.6156]]
            example:
              name: "Новое название"
              subscription_id: 3
              polygon_coordinates: [[55.7522, 37.6156], [55.7512, 37.6176], [55.7532, 37.6196], [55.7522, 37.6156]]
      responses:
        '200':
          description: Локация успешно обновлена
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    description: HTTP код ответа
                    example: 200
                  status:
                    type: string
                    description: Статус ответа
                    example: success
                  message:
                    type: string
                    description: Сообщение об успешном обновлении
                    example: "Локация успешно обновлена"
              example:
                code: 200
                status: success
                message: "Локация успешно обновлена"
        '400':
          description: Неверный формат запроса
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 400
                status: error
                message: "Отсутствует название локации"
                error: "validation_error"
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
                invalid_token:
                  value:
                    code: 401
                    status: error
                    message: "Invalid token"
                    error: "invalid_token"
        '404':
          description: Локация не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 404
                status: error
                message: "Локация не найдена"
                error: "not_found"
        '422':
          description: Ошибка валидации или сохранения данных
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 422
                status: error
                message: "Не удалось обновить геометрические поля"
                error: "save_failed"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"
    
    delete:
      tags:
        - Локации
      summary: Удаление локации пользователя
      description: |
        Удаляет локацию пользователя по указанному ID.
        
        Требуется аутентификация с помощью JWT токена.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID локации для удаления
          schema:
            type: integer
          example: 1
      responses:
        '200':
          description: Локация успешно удалена
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    description: HTTP код ответа
                    example: 200
                  status:
                    type: string
                    description: Статус ответа
                    example: success
                  message:
                    type: string
                    description: Сообщение об успешном удалении
                    example: "Локация успешно удалена"
              example:
                code: 200
                status: success
                message: "Локация успешно удалена"
        '400':
          description: Неверный формат запроса
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 400
                status: error
                message: "Не указан ID локации"
                error: "validation_error"
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
                invalid_token:
                  value:
                    code: 401
                    status: error
                    message: "Invalid token"
                    error: "invalid_token"
        '404':
          description: Локация не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 404
                status: error
                message: "Локация не найдена"
                error: "not_found"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/me/info:
    get:
      tags:
        - Пользователь
      summary: Получение информации о пользователе
      description: |
        Возвращает основную информацию о пользователе, включая статус подписки и настройки.
        
        Если у пользователя есть активные подписки, возвращается информация о самой поздней подписке:
        - Дата и время окончания
        - Количество оставшихся дней
        
        Если активных подписок нет, возвращается соответствующий текст.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Успешное получение информации
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/UserInfo'
              examples:
                with_active_subscription:
                  value:
                    code: 200
                    status: success
                    data:
                      user:
                        id: 1
                        name: "John Doe"
                        telegram_photo_url: "https://t.me/i/userpic/320/123456789.jpg"
                        role: "user"
                        is_trial_used: false
                        phone_status: true
                        auto_call: true
                        auto_call_raised: false
                        has_active_subscription: true
                        subscription_status_text: "Доступ до 31.12.2024 23:59\nОсталось 30 дней"
                without_subscription:
                  value:
                    code: 200
                    status: success
                    data:
                      user:
                        id: 1
                        name: "John Doe"
                        telegram_photo_url: "https://t.me/i/userpic/320/123456789.jpg"
                        role: "user"
                        is_trial_used: true
                        phone_status: false
                        auto_call: false
                        auto_call_raised: false
                        has_active_subscription: false
                        subscription_status_text: "Нет активных подписок"
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
        '404':
          description: Пользователь не найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 404
                status: error
                message: "Пользователь не найден"
                error: "not_found"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/me/status:
    get:
      tags:
        - Пользователь
      summary: Получение статуса телефона и автозвонка
      description: Возвращает текущий статус телефона пользователя и настройку автозвонка
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Успешное получение статуса
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  status:
                    type: string
                    example: success
                  data:
                    $ref: '#/components/schemas/UserStatus'
              example:
                code: 200
                status: success
                data:
                  phone_status: true
                  auto_call: false
                  auto_call_raised: false
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
        '404':
          description: Пользователь не найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 404
                status: error
                message: "Пользователь не найден"
                error: "not_found"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/me/auto-call:
    put:
      tags:
        - Пользователь
      summary: Обновление статуса автозвонка
      description: >
        Обновляет настройку автоматического звонка пользователя.
        Требует аутентификации.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AutoCallStatus'
            example:
              auto_call: true
      responses:
        '200':
          description: Успешное обновление
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Статус автозвонка успешно обновлен
        '400':
          description: Ошибка валидации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingAutoCall:
                  value:
                    code: 400
                    status: error
                    message: "Неверный формат запроса. Отсутствует обязательное поле auto_call"
                invalidAutoCall:
                  value:
                    code: 400
                    status: error
                    message: "Неверный формат запроса. Поле auto_call должно быть boolean"
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 401
                status: error
                message: Unauthorized
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/me/auto-call-raised:
    put:
      tags:
        - Пользователь
      summary: Обновление статуса автозвонка на поднятые объявления
      description: >
        Обновляет настройку автоматического звонка на поднятые объявления.
        Требует аутентификации.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - auto_call_raised
              properties:
                auto_call_raised:
                  type: boolean
                  description: Включен ли автоматический звонок на поднятые объявления
                  example: true
            example:
              auto_call_raised: true
      responses:
        '200':
          description: Успешное обновление
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Статус автозвонка на поднятые объявления успешно обновлен
        '400':
          description: Ошибка валидации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingAutoCallRaised:
                  value:
                    code: 400
                    status: error
                    message: "Неверный формат запроса. Отсутствует обязательное поле auto_call_raised"
                invalidAutoCallRaised:
                  value:
                    code: 400
                    status: error
                    message: "Неверный формат запроса. Поле auto_call_raised должно быть boolean"
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 401
                status: error
                message: Unauthorized
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/me/app-login:
    get:
      tags:
        - Пользователь
      summary: Получение логина для приложения
      description: |
        Возвращает логин пользователя для входа в мобильное приложение.
        Логин представляет собой ID пользователя в системе.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Успешное получение логина
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      login:
                        type: string
                        description: Логин пользователя (ID)
                        example: "123"
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
        '404':
          description: Пользователь не найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 404
                status: error
                message: "Пользователь не найден"
                error: "not_found"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/me/generate-password:
    post:
      tags:
        - Пользователь
      summary: Генерация нового пароля для приложения
      description: |
        Генерирует новый пароль для входа в мобильное приложение.
        Новый пароль отправляется пользователю в Telegram.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Пароль успешно сгенерирован
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: "Новый пароль успешно сгенерирован и отправлен в Telegram"
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
        '404':
          description: Пользователь не найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 404
                status: error
                message: "Пользователь не найден"
                error: "not_found"
        '422':
          description: Ошибка при отправке сообщения в Telegram
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 422
                status: error
                message: "Не удалось отправить сообщение в Telegram"
                error: "telegram_send_failed"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/me/download-info:
    get:
      tags:
        - Пользователь
      summary: Получение информации о доступных приложениях для скачивания
      description: |
        Возвращает информацию о доступных для скачивания приложениях.
        
        Включает информацию о наличии файла, его размере и URL для скачивания.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Успешное получение информации
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  status:
                    type: string
                    example: success
                  data:
                    type: object
                    properties:
                      android:
                        type: object
                        properties:
                          available:
                            type: boolean
                            description: Доступен ли файл для скачивания
                            example: true
                          size:
                            type: integer
                            nullable: true
                            description: Размер файла в байтах
                            example: 15728640
                          size_formatted:
                            type: string
                            nullable: true
                            description: Размер файла в читаемом формате
                            example: "15 MB"
                          download_url:
                            type: string
                            description: URL для скачивания
                            example: "/api/v1/me/download/android"
                      ios:
                        type: object
                        properties:
                          available:
                            type: boolean
                            description: Доступен ли файл для скачивания
                            example: false
                          size:
                            type: integer
                            nullable: true
                            description: Размер файла в байтах
                            example: null
                          download_url:
                            type: string
                            nullable: true
                            description: URL для скачивания
                            example: null
              example:
                code: 200
                status: success
                data:
                  android:
                    available: true
                    size: 15728640
                    size_formatted: "15 MB"
                    download_url: "/api/v1/me/download/android"
                  ios:
                    available: false
                    size: null
                    download_url: null
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/me/download/android:
    get:
      tags:
        - Пользователь
      summary: Скачать Android приложение
      description: |
        Скачивает APK файл Android приложения.
        
        Требуется авторизация. Файл возвращается как бинарный поток.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Файл успешно возвращён
          content:
            application/vnd.android.package-archive:
              schema:
                type: string
                format: binary
          headers:
            Content-Disposition:
              schema:
                type: string
                example: 'attachment; filename="FirstCall.apk"'
            Content-Length:
              schema:
                type: integer
                example: 15728640
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
        '404':
          description: Файл приложения не найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 404
                status: error
                message: "Файл приложения не найден"
                error: "file_not_found"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/catalog/tariff-price/{tariffId}/{locationId}:
    get:
      tags:
        - Подписки
      summary: Получение цены тарифа для локации
      description: |
        Возвращает цену тарифа для выбранной локации.
        
        Требуется аутентификация с помощью JWT токена.
      parameters:
        - name: tariffId
          in: path
          required: true
          description: ID тарифа
          schema:
            type: integer
            format: int64
            minimum: 1
          example: 2
        - name: locationId
          in: path
          required: true
          description: ID локации
          schema:
            type: integer
            format: int64
            minimum: 1
          example: 1
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Цена успешно получена
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    description: HTTP код ответа
                    example: 200
                  status:
                    type: string
                    description: Статус ответа
                    example: success
                  data:
                    type: object
                    properties:
                      price:
                        type: number
                        format: float
                        description: Цена тарифа для указанной локации
                        example: 1000.00
              example:
                code: 200
                status: success
                data:
                  price: 1000.00
        '400':
          description: Ошибка валидации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 400
                status: error
                message: Не указаны необходимые параметры
                error: validation_error
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
        '404':
          description: Цена не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 404
                status: error
                message: Цена не найдена
                error: not_found
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: Внутренняя ошибка сервера
                error: internal_error

  /api/v1/catalog/tariff-info:
    get:
      tags:
        - Подписки
      summary: Получение всей информации о тарифах
      description: |
        Возвращает полную информацию для страницы тарифов:
        - Список всех категорий
        - Список всех локаций
        - Список всех тарифов с описаниями
        - Связку тариф-локация-цена для всех возможных комбинаций
        
        Требуется аутентификация с помощью JWT токена.
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Информация успешно получена
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    description: HTTP код ответа
                    example: 200
                  status:
                    type: string
                    description: Статус ответа
                    example: success
                  data:
                    type: object
                    properties:
                      categories:
                        type: array
                        description: Список всех категорий
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                              description: ID категории
                              example: 1
                            name:
                              type: string
                              description: Название категории
                              example: "Аренда. Жилая"
                      locations:
                        type: array
                        description: Список всех локаций
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                              description: ID локации
                              example: 1
                            name:
                              type: string
                              description: Название локации
                              example: "Москва, Московская область"
                      tariffs:
                        type: array
                        description: Список всех активных тарифов
                        items:
                          type: object
                          properties:
                            id:
                              type: integer
                              description: ID тарифа
                              example: 1
                            name:
                              type: string
                              description: Название тарифа
                              example: "Demo"
                            description:
                              type: string
                              description: Описание тарифа
                              example: "Демо-версия с ограниченным функционалом на 3 часа"
                      tariff_prices:
                        type: array
                        description: Связка тариф-локация-цена
                        items:
                          type: object
                          properties:
                            tariff_id:
                              type: integer
                              description: ID тарифа
                              example: 1
                            location_id:
                              type: integer
                              description: ID локации
                              example: 1
                            price:
                              type: number
                              format: float
                              description: Цена тарифа для указанной локации
                              example: 0.00
              example:
                code: 200
                status: success
                data:
                  categories:
                    - id: 1
                      name: "Аренда. Жилая"
                    - id: 2
                      name: "Продажа. Жилая"
                  locations:
                    - id: 1
                      name: "Москва, Московская область"
                    - id: 2
                      name: "Санкт-Петербург, Ленинградская область"
                  tariffs:
                    - id: 1
                      name: "Demo"
                      description: "Демо-версия с ограниченным функционалом на 3 часа"
                    - id: 2
                      name: "1 день"
                      description: "Полный доступ ко всем функциям на 1 день"
                  tariff_prices:
                    - tariff_id: 1
                      location_id: 1
                      price: 0.00
                    - tariff_id: 1
                      location_id: 2
                      price: 0.00
                    - tariff_id: 2
                      location_id: 1
                      price: 1000.00
                    - tariff_id: 2
                      location_id: 2
                      price: 1000.00
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: Внутренняя ошибка сервера
                error: internal_error

  /api/v1/admin/subscriptions/activate:
    post:
      tags:
        - Администрирование
      summary: Активация подписки
      description: |
        Активирует подписку со статусом pending.
        
        Только для администраторов. После активации пользователь получает доступ
        к функциям системы в соответствии с выбранным тарифом.
        
        Если пользователь имеет активные демо-подписки, они будут автоматически отменены.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - subscription_id
                - payment_method
              properties:
                subscription_id:
                  type: integer
                  description: ID подписки для активации
                  example: 5
                payment_method:
                  type: string
                  description: Метод оплаты
                  example: "card"
                notes:
                  type: string
                  description: Примечания к активации
                  example: "Подтверждено по чеку #12345"
                duration_hours:
                  type: integer
                  description: Продолжительность подписки в часах (если не указано, берется из тарифа)
                  example: 720
            example:
              subscription_id: 5
              payment_method: "card"
              notes: "Подтверждено по чеку #12345"
              duration_hours: 720
      responses:
        '200':
          description: Подписка успешно активирована
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    description: HTTP код ответа
                    example: 200
                  status:
                    type: string
                    description: Статус ответа
                    example: success
                  message:
                    type: string
                    description: Сообщение об успешной активации
                    example: "Подписка успешно активирована"
                  data:
                    type: object
                    properties:
                      activated_subscription:
                        type: object
                        properties:
                          id:
                            type: integer
                            description: ID подписки
                            example: 12
                          start_date:
                            type: string
                            description: Дата и время начала подписки
                            example: "2025-05-18 18:19:00"
                          end_date:
                            type: string
                            description: Дата и время окончания подписки
                            example: "2025-05-19 18:19:00"
              example:
                code: 200
                status: success
                message: "Подписка успешно активирована"
                data:
                  activated_subscription:
                    id: 12
                    start_date: "2025-05-18 18:19:00"
                    end_date: "2025-05-19 18:19:00"
        '400':
          description: Ошибка валидации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 400
                status: error
                message: "Не указан ID подписки"
                error: "validation_error"
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 401
                status: error
                message: "Access token expired"
                error: "token_expired"
        '403':
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 403
                status: error
                message: "Недостаточно прав для выполнения операции"
                error: "forbidden"
        '404':
          description: Подписка не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 404
                status: error
                message: "Подписка не найдена"
                error: "not_found"
        '422':
          description: Ошибка обработки
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 422
                status: error
                message: "Невозможно активировать подписку, она уже активна"
                error: "validation_error"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/admin/subscriptions/extend:
    post:
      tags:
        - Администрирование
      summary: Продление подписки
      description: |
        Продлевает активную подписку на указанное количество часов.
        
        Только для администраторов. Продление работает только для активных подписок, 
        которые еще не истекли. После продления дата окончания подписки 
        увеличивается на указанное количество часов от текущей даты окончания.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - subscription_id
                - payment_method
              properties:
                subscription_id:
                  type: integer
                  description: ID подписки для продления
                  example: 5
                payment_method:
                  type: string
                  description: Метод оплаты
                  example: "card"
                duration_hours:
                  type: integer
                  description: Количество часов, на которое необходимо продлить подписку (если не указано, берется из тарифа)
                  example: 720
                notes:
                  type: string
                  description: Примечание к продлению подписки
                  example: "Продление по запросу клиента"
                price:
                  type: number
                  description: Новая цена подписки (если не указано, используется прежняя цена)
                  example: 5000
            example:
              subscription_id: 5
              payment_method: "card"
              duration_hours: 720
              notes: "Продление по запросу клиента"
      responses:
        '200':
          description: Подписка успешно продлена
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    description: HTTP код ответа
                    example: 200
                  status:
                    type: string
                    description: Статус ответа
                    example: success
                  message:
                    type: string
                    description: Сообщение об успешном продлении
                    example: "Подписка успешно продлена"
              example:
                code: 200
                status: success
                message: "Подписка успешно продлена"
        '400':
          description: Ошибка валидации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 400
                status: error
                message: "Не указан ID подписки"
                error: "validation_error"
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 401
                status: error
                message: "Access token expired"
                error: "token_expired"
        '403':
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 403
                status: error
                message: "Недостаточно прав для выполнения операции"
                error: "forbidden"
        '404':
          description: Подписка не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 404
                status: error
                message: "Подписка не найдена"
                error: "not_found"
        '422':
          description: Ошибка обработки
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 422
                status: error
                message: "Невозможно продлить подписку, она была отменена"
                error: "validation_error"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/v1/subscriptions/extend-request:
    post:
      tags:
        - Подписки
      summary: Создание заявки на продление подписки
      description: |
        Создает заявку на продление подписки пользователя.
        
        После создания заявки администратор получает уведомление и принимает
        решение о продлении. Подписка может быть продлена только после оплаты.
        
        Требуется аутентификация с помощью JWT токена.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - subscription_id
                - tariff_id
              properties:
                subscription_id:
                  type: integer
                  description: ID подписки для продления
                  example: 5
                tariff_id:
                  type: integer
                  description: ID тарифа для продления (может совпадать или отличаться от текущего)
                  example: 3
                notes:
                  type: string
                  description: Комментарий пользователя к заявке
                  example: "Хочу продлить на месяц"
            example:
              subscription_id: 5
              tariff_id: 3
              notes: "Хочу продлить на месяц"
      responses:
        '200':
          description: Заявка на продление успешно создана
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    description: HTTP код ответа
                    example: 200
                  status:
                    type: string
                    description: Статус ответа
                    example: success
                  message:
                    type: string
                    description: Сообщение об успешном создании заявки
                    example: "Заявка на продление подписки успешно отправлена администратору"
                  data:
                    type: object
                    properties:
                      subscription_id:
                        type: integer
                        description: ID подписки
                        example: 5
              example:
                code: 200
                status: success
                message: "Заявка на продление подписки успешно отправлена администратору"
                data:
                  subscription_id: 5
        '400':
          description: Ошибка валидации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missing_subscription_id:
                  value:
                    code: 400
                    status: error
                    message: "Необходимо указать ID подписки для продления"
                    error: "validation_error"
                missing_tariff_id:
                  value:
                    code: 400
                    status: error
                    message: "Необходимо указать тариф для продления"
                    error: "validation_error"
                invalid_tariff:
                  value:
                    code: 400
                    status: error
                    message: "Указанный тариф не найден или неактивен"
                    error: "validation_error"
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 401
                status: error
                message: "Access token expired"
                error: "token_expired"
        '404':
          description: Подписка не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 404
                status: error
                message: "Подписка не найдена"
                error: "not_found"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error" 

  /api/v1/admin/subscriptions/cancel:
    post:
      tags:
        - Администрирование
      summary: Отмена подписки администратором
      description: |
        Отменяет подписку пользователя.
        
        Только для администраторов. После отмены подписка становится недоступной 
        для использования. Пользователь получает уведомление об отмене подписки.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - subscription_id
              properties:
                subscription_id:
                  type: integer
                  description: ID подписки для отмены
                  example: 5
                reason:
                  type: string
                  description: Причина отмены подписки
                  example: "Отменено по запросу пользователя"
            example:
              subscription_id: 5
              reason: "Отменено по запросу пользователя"
      responses:
        '200':
          description: Подписка успешно отменена
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    description: HTTP код ответа
                    example: 200
                  status:
                    type: string
                    description: Статус ответа
                    example: success
                  message:
                    type: string
                    description: Сообщение об успешной отмене
                    example: "Подписка успешно отменена"
              example:
                code: 200
                status: success
                message: "Подписка успешно отменена"
        '400':
          description: Ошибка валидации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 400
                status: error
                message: "Необходимо указать ID подписки для отмены"
                error: "validation_error"
        '401':
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 401
                status: error
                message: "Access token expired"
                error: "token_expired"
        '403':
          description: Доступ запрещен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 403
                status: error
                message: "Недостаточно прав для выполнения операции"
                error: "forbidden"
        '404':
          description: Подписка не найдена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 404
                status: error
                message: "Подписка не найдена"
                error: "not_found"
        '500':
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Внутренняя ошибка сервера"
                error: "internal_error"

  /api/admin/subscriptions:
    post:
      summary: Получение текущих подписок (административная панель)
      description: Возвращает список подписок с возможностью фильтрации и сортировки. Доступно только для администраторов.
      tags:
        - Billing
        - Администрирование
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                page:
                  type: integer
                  description: Номер страницы для пагинации
                  default: 1
                  example: 1
                per_page:
                  type: integer
                  description: Количество записей на странице
                  default: 20
                  example: 20
                sorting:
                  type: object
                  description: Параметры сортировки
                  additionalProperties:
                    type: string
                    enum: [ASC, DESC]
                  example:
                    created_at: "DESC"
                filters:
                  type: object
                  description: Фильтры для поиска подписок
                  properties:
                    created_at:
                      type: object
                      description: Диапазон дат создания подписки
                      properties:
                        from:
                          type: string
                          description: Начальная дата в формате DD.MM.YYYY
                          example: "20.06.2025"
                        to:
                          type: string
                          description: Конечная дата в формате DD.MM.YYYY
                          example: "20.06.2025"
                    subscription_id:
                      type: integer
                      description: ID подписки
                      example: 14
                    user_id:
                      type: integer
                      description: ID пользователя
                      example: 12
                    tariff_id:
                      type: integer
                      description: ID тарифа
                      example: 2
                    status:
                      type: array
                      description: Статусы подписок для фильтрации
                      items:
                        type: string
                        enum: [active, pending, cancelled, expired]
                      example: ["active", "pending"]
                    days_left_min:
                      type: integer
                      description: Минимальное количество оставшихся дней
                      example: 1
                    days_left_max:
                      type: integer
                      description: Максимальное количество оставшихся дней
                      example: 30
            example:
              page: 1
              per_page: 20
              sorting:
                created_at: "DESC"
              filters:
                created_at:
                  from: "20.06.2025"
                  to: "20.06.2025"
                subscription_id: 14
                user_id: 12
                tariff_id: 2
                status: ["active", "pending"]
                days_left_min: 1
                days_left_max: 30
      responses:
        "200":
          description: Успешный ответ с подписками
          content:
            application/json:
              schema:
                type: object
                properties:
                  meta:
                    type: object
                    description: Метаданные пагинации
                    properties:
                      total:
                        type: integer
                        description: Общее количество записей
                        example: 2
                      per_page:
                        type: integer
                        description: Количество записей на странице
                        example: 20
                      current_page:
                        type: integer
                        description: Текущая страница
                        example: 1
                      total_pages:
                        type: integer
                        description: Общее количество страниц
                        example: 1
                      from:
                        type: integer
                        description: Номер первой записи на текущей странице
                        example: 1
                      to:
                        type: integer
                        description: Номер последней записи на текущей странице
                        example: 2
                  data:
                    type: array
                    description: Список подписок
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          description: ID подписки
                          example: 14
                        created_at:
                          type: string
                          format: date-time
                          description: Дата и время создания подписки
                          example: "2025-05-19 19:27:43"
                        tariff_info:
                          type: string
                          description: Информация о тарифе в формате "Тариф, Категория, Город и Область"
                          example: "Премиум, Продажа. Жилая, Омск и Омская область"
                        telegram:
                          type: string
                          description: Telegram-username пользователя
                          example: "sokolovserge"
                        status:
                          type: string
                          description: Статус подписки
                          enum: [active, pending, cancelled, expired]
                          example: "active"
                        payment_method:
                          type: string
                          nullable: true
                          description: Способ оплаты
                          example: "cash"
                        admin_notes:
                          type: string
                          nullable: true
                          description: Примечания администратора
                          example: "Активировано администратором"
                        days_left:
                          type: string
                          description: Оставшееся время действия подписки с указанием единиц измерения (дни, часы, минуты)
                          example: "0 дн."
                        start_date:
                          type: string
                          format: date-time
                          nullable: true
                          description: Дата и время начала подписки
                          example: "2025-05-19 19:29:33"
                        end_date:
                          type: string
                          format: date-time
                          nullable: true
                          description: Дата и время окончания подписки
                          example: "2025-05-20 19:29:33"
                        user_id:
                          type: integer
                          description: ID пользователя
                          example: 10
                        price_paid:
                          type: number
                          format: float
                          description: Оплаченная сумма
                          example: 1000
              example:
                meta:
                  total: 2
                  per_page: 20
                  current_page: 1
                  total_pages: 1
                  from: 1
                  to: 2
                data:
                  - id: 14
                    created_at: "2025-05-19 19:27:43"
                    tariff_info: "Премиум, Продажа. Жилая, Омск и Омская область"
                    telegram: "sokolovserge"
                    status: "active"
                    payment_method: "cash"
                    admin_notes: "Активировано администратором"
                    days_left: "0 дн."
                    start_date: "2025-05-19 19:29:33"
                    end_date: "2025-05-20 19:29:33"
                    user_id: 10
                    price_paid: 1000
                  - id: 13
                    created_at: "2025-05-19 18:39:28"
                    tariff_info: "Демо, Продажа. Жилая, Омск и Омская область"
                    telegram: "sokolovserge"
                    status: "cancelled"
                    payment_method: null
                    admin_notes: null
                    days_left: "0 дн."
                    start_date: "2025-05-19 18:39:28"
                    end_date: "2025-05-19 21:39:28"
                    user_id: 10
                    price_paid: 0
        "403":
          description: Доступ запрещен (требуются права администратора)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 403
                status: error
                message: "У вас нет доступа к этому ресурсу"
                error: "access_denied"
        "500":
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Ошибка при получении данных"
                error: "internal_error"

  /api/v1/billing/subscriptions:
    post:
      summary: Получение текущих подписок пользователя
      description: Возвращает список подписок текущего пользователя с возможностью фильтрации и сортировки.
      tags:
        - Подписки
        - Billing
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                page:
                  type: integer
                  description: Номер страницы для пагинации
                  default: 1
                  example: 1
                per_page:
                  type: integer
                  description: Количество записей на странице
                  default: 20
                  example: 20
                sorting:
                  type: object
                  description: Параметры сортировки
                  additionalProperties:
                    type: string
                    enum: [ASC, DESC]
                  example:
                    created_at: "DESC"
                filters:
                  type: object
                  description: Фильтры для поиска подписок
                  properties:
                    created_at:
                      type: object
                      description: Диапазон дат создания подписки
                      properties:
                        from:
                          type: string
                          description: Начальная дата в формате DD.MM.YYYY
                          example: "20.06.2025"
                        to:
                          type: string
                          description: Конечная дата в формате DD.MM.YYYY
                          example: "20.06.2025"
                    subscription_id:
                      type: integer
                      description: ID подписки
                      example: 14
                    status:
                      type: array
                      description: Статусы подписок для фильтрации
                      items:
                        type: string
                        enum: [active, pending, cancelled, expired]
                      example: ["active", "pending"]
            example:
              page: 1
              per_page: 20
              sorting:
                created_at: "DESC"
              filters:
                created_at:
                  from: "20.06.2025"
                  to: "20.06.2025"
                subscription_id: 14
                status: ["active", "pending"]
      responses:
        "200":
          description: Успешный ответ с подписками пользователя
          content:
            application/json:
              schema:
                type: object
                properties:
                  meta:
                    type: object
                    description: Метаданные пагинации
                    properties:
                      total:
                        type: integer
                        description: Общее количество записей
                        example: 1
                      per_page:
                        type: integer
                        description: Количество записей на странице
                        example: 20
                      current_page:
                        type: integer
                        description: Текущая страница
                        example: 1
                      total_pages:
                        type: integer
                        description: Общее количество страниц
                        example: 1
                      from:
                        type: integer
                        description: Номер первой записи на текущей странице
                        example: 1
                      to:
                        type: integer
                        description: Номер последней записи на текущей странице
                        example: 1
                  data:
                    type: array
                    description: Список подписок пользователя
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          description: ID подписки
                          example: 14
                        created_at:
                          type: string
                          format: date-time
                          description: Дата и время создания подписки
                          example: "2025-05-19 19:27:43"
                        tariff_info:
                          type: string
                          description: Информация о тарифе в формате "Тариф, Категория, Город и Область"
                          example: "Премиум, Продажа. Жилая, Омск и Омская область"
                        status:
                          type: string
                          description: Статус подписки
                          enum: [active, pending, cancelled, expired]
                          example: "active"
                        days_left:
                          type: string
                          description: Оставшееся время действия подписки с указанием единиц измерения
                          example: "0 дн."
                        start_date:
                          type: string
                          format: date-time
                          nullable: true
                          description: Дата и время начала подписки
                          example: "2025-05-19 19:29:33"
                        end_date:
                          type: string
                          format: date-time
                          nullable: true
                          description: Дата и время окончания подписки
                          example: "2025-05-20 19:29:33"
              example:
                meta:
                  total: 1
                  per_page: 20
                  current_page: 1
                  total_pages: 1
                  from: 1
                  to: 1
                data:
                  - id: 14
                    created_at: "2025-05-19 19:27:43"
                    tariff_info: "Премиум, Продажа. Жилая, Омск и Омская область"
                    status: "active"
                    days_left: "0 дн."
                    start_date: "2025-05-19 19:29:33"
                    end_date: "2025-05-20 19:29:33"
        "401":
          description: Не авторизован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                token_not_found:
                  value:
                    code: 401
                    status: error
                    message: "Access token not found"
                    error: "token_not_found"
                token_expired:
                  value:
                    code: 401
                    status: error
                    message: "Access token expired"
                    error: "token_expired"
        "500":
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Ошибка при получении данных"
                error: "internal_error"

  /api/v1/admin/subscription-history:
    post:
      summary: Получение истории подписок (административная панель)
      description: |
        Возвращает историю изменений подписок с возможностью фильтрации и сортировки.
        Доступно только для администраторов системы.
      tags:
        - Billing
        - Администрирование
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                page:
                  type: integer
                  description: Номер страницы для пагинации
                  default: 1
                  example: 1
                per_page:
                  type: integer
                  description: Количество записей на странице
                  default: 20
                  example: 20
                sorting:
                  type: object
                  description: Параметры сортировки
                  additionalProperties:
                    type: string
                    enum: [ASC, DESC]
                  example:
                    action_date: "DESC"
                filters:
                  type: object
                  description: Фильтры для поиска записей истории
                  properties:
                    action_date:
                      type: object
                      description: Диапазон дат действий
                      properties:
                        from:
                          type: string
                          description: Начальная дата в формате DD.MM.YYYY
                          example: "20.06.2025"
                        to:
                          type: string
                          description: Конечная дата в формате DD.MM.YYYY
                          example: "20.06.2025"
                    subscription_id:
                      type: integer
                      description: ID подписки
                      example: 14
                    user_id:
                      type: integer
                      description: ID пользователя
                      example: 10
                    action:
                      type: array
                      description: Типы действий для фильтрации
                      items:
                        type: string
                        enum: [created, requested, activated, extended, cancelled, expired, extend_requested]
                      example: ["created", "requested", "activated"]
            example:
              page: 1
              per_page: 20
              sorting:
                action_date: "DESC"
              filters:
                action_date:
                  from: "20.06.2025"
                  to: "20.06.2025"
                subscription_id: 14
                user_id: 10
                action: ["created", "requested", "activated", "extended", "cancelled", "expired", "extend_requested"]
      responses:
        "200":
          description: Успешный ответ с историей подписок
          content:
            application/json:
              schema:
                type: object
                properties:
                  meta:
                    type: object
                    description: Метаданные пагинации
                    properties:
                      total:
                        type: integer
                        description: Общее количество записей
                        example: 7
                      per_page:
                        type: integer
                        description: Количество записей на странице
                        example: 20
                      current_page:
                        type: integer
                        description: Текущая страница
                        example: 1
                      total_pages:
                        type: integer
                        description: Общее количество страниц
                        example: 1
                      from:
                        type: integer
                        description: Номер первой записи на текущей странице
                        example: 1
                      to:
                        type: integer
                        description: Номер последней записи на текущей странице
                        example: 7
                  data:
                    type: array
                    description: Список записей истории подписок
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          description: ID записи истории
                          example: 37
                        subscription_id:
                          type: integer
                          description: ID подписки
                          example: 14
                        user_id:
                          type: integer
                          description: ID пользователя
                          example: 10
                        tariff_info:
                          type: string
                          description: Информация о тарифе в формате "Тариф, Категория, Город, Область"
                          example: "Премиум, Продажа. Жилая, Омск, Омская область"
                        old_status:
                          type: string
                          description: Предыдущий статус подписки (человекочитаемый)
                          example: "Активная (ожидает продления)"
                        new_status:
                          type: string
                          description: Новый статус подписки (человекочитаемый)
                          example: "Ожидает продления"
                        price:
                          type: number
                          format: float
                          description: Сумма оплаты
                          example: 0
                        action_date:
                          type: string
                          format: date-time
                          description: Дата и время действия
                          example: "2025-05-19 19:35:30"
                        notes:
                          type: string
                          description: Примечания к действию
                          example: "Подписка активирована администратором"
              example:
                meta:
                  total: 7
                  per_page: 20
                  current_page: 1
                  total_pages: 1
                  from: 1
                  to: 7
                data:
                  - id: 37
                    subscription_id: 14
                    user_id: 10
                    tariff_info: "Премиум, Продажа. Жилая, Омск, Омская область"
                    old_status: "Активная (ожидает продления)"
                    new_status: "Ожидает продления"
                    price: 0
                    action_date: "2025-05-19 19:35:30"
                    notes: ""
                  - id: 36
                    subscription_id: 14
                    user_id: 10
                    tariff_info: "Премиум, Продажа. Жилая, Омск, Омская область"
                    old_status: "Активная (ожидает продления)"
                    new_status: "Ожидает продления"
                    price: 0
                    action_date: "2025-05-19 19:33:33"
                    notes: ""
                  - id: 34
                    subscription_id: 14
                    user_id: 10
                    tariff_info: "Премиум, Продажа. Жилая, Омск, Омская область"
                    old_status: "Ожидает подтверждения/активации"
                    new_status: "Активная"
                    price: 1000
                    action_date: "2025-05-19 19:29:33"
                    notes: "Подписка активирована администратором. Примечание: Активировано администратором"
        "403":
          description: Доступ запрещен (требуются права администратора)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 403
                status: error
                message: "У вас нет доступа к этому ресурсу"
                error: "access_denied"
        "500":
          description: Внутренняя ошибка сервера
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                code: 500
                status: error
                message: "Ошибка при получении данных"
                error: "internal_error"